{
  "info": {
    "name": "CPSC Backend API",
    "description": "Collection for CPSC Backend API with AWS Cognito authentication",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Authentication",
      "item": [
        {
          "name": "Sign Up",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"user@example.com\",\n  \"password\": \"Test@1234\",\n  \"screenName\": \"JohnDoe123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/signup",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "auth",
                "signup"
              ]
            },
            "description": "Register a new user in AWS Cognito with a screen name. User will receive a verification code via email."
          },
          "response": []
        },
        {
          "name": "Confirm Sign Up",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"user@example.com\",\n  \"confirmationCode\": \"123456\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/confirm",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "auth",
                "confirm"
              ]
            },
            "description": "Confirm user signup with the verification code sent to their email. Must be done before login."
          },
          "response": []
        },
        {
          "name": "Resend Verification Code",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"user@example.com\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/resend-code",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "auth",
                "resend-code"
              ]
            },
            "description": "Resend the verification code to the user's email if they didn't receive it or it expired."
          },
          "response": []
        },
        {
          "name": "Login",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"user@example.com\",\n  \"password\": \"Test@1234\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/login",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "auth",
                "login"
              ]
            },
            "description": "Authenticate user and receive JWT tokens. User must be confirmed before logging in."
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Automatically save the idToken to environment variable",
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.environment.set(\"idToken\", jsonData.idToken);",
                  "    pm.environment.set(\"accessToken\", jsonData.accessToken);",
                  "    pm.environment.set(\"refreshToken\", jsonData.refreshToken);",
                  "    console.log(\"Tokens saved to environment variables\");",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Protected Endpoints",
      "item": [
        {
          "name": "Get Profile",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}",
                "description": "Access token from login (required for Cognito GetUser API)"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/secure/profile",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "secure",
                "profile"
              ]
            },
            "description": "Get authenticated user's profile including email and screen name. This endpoint requires the ACCESS TOKEN (not ID token) because it uses AWS Cognito's GetUser API."
          },
          "response": []
        }
      ]
    },
    {
      "name": "Institutions",
      "item": [
        {
          "name": "Create Institution",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{idToken}}",
                "description": "JWT token from login"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"institutionName\": \"Chase Bank\",\n  \"startingBalance\": 324.50\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/institutions",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "institutions"
              ]
            },
            "description": "Create a new financial institution with a starting balance for the authenticated user"
          },
          "response": []
        },
        {
          "name": "Get Institutions",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{idToken}}",
                "description": "JWT token from login"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/institutions?limit=50",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "institutions"
              ],
              "query": [
                {
                  "key": "limit",
                  "value": "50",
                  "description": "Maximum number of institutions to return (1-100, default 50)"
                },
                {
                  "key": "lastEvaluatedKey",
                  "value": "",
                  "description": "Pagination token from previous response (use nextToken value)",
                  "disabled": true
                }
              ]
            },
            "description": "Get financial institutions for the authenticated user with pagination support. Use the nextToken from response to get next page."
          },
          "response": []
        },
        {
          "name": "Edit Institution",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{idToken}}",
                "description": "JWT token from login"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"institutionName\": \"Updated Bank Name\",\n  \"startingBalance\": 1500.00,\n  \"allocatedPercent\": 75\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/institutions/550e8400-e29b-41d4-a716-446655440000",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "institutions",
                "550e8400-e29b-41d4-a716-446655440000"
              ]
            },
            "description": "Edit an existing institution's name, starting balance, and/or allocated percent. All fields are optional. If startingBalance is changed, currentBalance is adjusted by the same difference. allocatedPercent shows how much of this institution's balance is allocated to goals (0-100, default 0). Replace the UUID in the path with the actual institutionId from Get Institutions response."
          },
          "response": []
        },
        {
          "name": "Delete Institution",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{idToken}}",
                "description": "JWT token from login"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/institutions/550e8400-e29b-41d4-a716-446655440000",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "institutions",
                "550e8400-e29b-41d4-a716-446655440000"
              ]
            },
            "description": "Delete a specific institution for the authenticated user. Replace the UUID in the path with the actual institutionId from Get Institutions response."
          },
          "response": []
        }
      ]
    },
    {
      "name": "Transactions",
      "item": [
        {
          "name": "Create Transaction",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{idToken}}",
                "description": "JWT token from login"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"type\": \"DEPOSIT\",\n  \"amount\": 1000.50,\n  \"tags\": [\"salary\", \"monthly\"],\n  \"description\": \"January salary deposit\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/institutions/550e8400-e29b-41d4-a716-446655440000/transactions",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "institutions",
                "550e8400-e29b-41d4-a716-446655440000",
                "transactions"
              ]
            },
            "description": "Create a new transaction (deposit or withdrawal) for a specific institution. Replace the UUID in the path with the actual institutionId from Get Institutions response. Type can be DEPOSIT or WITHDRAWAL."
          },
          "response": []
        },
        {
          "name": "Get Institution Transactions",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{idToken}}",
                "description": "JWT token from login"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/institutions/550e8400-e29b-41d4-a716-446655440000/transactions",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "institutions",
                "550e8400-e29b-41d4-a716-446655440000",
                "transactions"
              ]
            },
            "description": "Retrieve all transactions for a specific institution, sorted by creation date (newest first). Replace the UUID in the path with the actual institutionId from Get Institutions response."
          },
          "response": []
        },
        {
          "name": "Update Transaction",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{idToken}}",
                "description": "JWT token from login"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"type\": \"WITHDRAWAL\",\n  \"amount\": 200.00,\n  \"description\": \"Updated description for transaction\",\n  \"tags\": [\"updated\", \"expense\"],\n  \"transactionDate\": 1735041600\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/institutions/550e8400-e29b-41d4-a716-446655440000/transactions/550e8400-e29b-41d4-a716-446655440002",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "institutions",
                "550e8400-e29b-41d4-a716-446655440000",
                "transactions",
                "550e8400-e29b-41d4-a716-446655440002"
              ]
            },
            "description": "Update an existing transaction for the authenticated user. All fields in the request body are optional - only include the fields you want to update. Replace the institution UUID and transaction UUID in the path with actual IDs from Get Institution Transactions response."
          },
          "response": []
        },
        {
          "name": "Delete Transaction",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{idToken}}",
                "description": "JWT token from login"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/institutions/550e8400-e29b-41d4-a716-446655440000/transactions/550e8400-e29b-41d4-a716-446655440002",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "institutions",
                "550e8400-e29b-41d4-a716-446655440000",
                "transactions",
                "550e8400-e29b-41d4-a716-446655440002"
              ]
            },
            "description": "Delete a specific transaction for the authenticated user. Replace the institution UUID and transaction UUID in the path with actual IDs from Get Institution Transactions response."
          },
          "response": []
        }
      ]
    },
    {
      "name": "Goals",
      "item": [
        {
          "name": "Create Goal",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{idToken}}",
                "description": "JWT token from login"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Emergency Fund\",\n  \"description\": \"Save 6 months of expenses\",\n  \"targetAmount\": 10000.00,\n  \"linkedInstitutions\": {\n    \"550e8400-e29b-41d4-a716-446655440000\": 50,\n    \"550e8400-e29b-41d4-a716-446655440001\": 30\n  }\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/goals",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "goals"
              ]
            },
            "description": "Create a new goal with linked institutions and a target amount. The 'isCompleted' field is automatically calculated based on allocated amounts from linked institutions. When institution balances change (via edits or transactions), the goal completion status is automatically recalculated. Replace institution UUIDs with actual IDs from Get Institutions response."
          },
          "response": []
        },
        {
          "name": "Get Goals",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{idToken}}",
                "description": "JWT token from login"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/goals",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "goals"
              ]
            },
            "description": "Get all goals for the authenticated user, including linked institutions and their allocation percentages."
          },
          "response": []
        },
        {
          "name": "Edit Goal",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{idToken}}",
                "description": "JWT token from login"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Emergency Fund - Updated\",\n  \"description\": \"Save 12 months of expenses\",\n  \"targetAmount\": 20000.00,\n  \"linkedInstitutions\": {\n    \"550e8400-e29b-41d4-a716-446655440000\": 75,\n    \"550e8400-e29b-41d4-a716-446655440001\": 25\n  }\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/goals/:goalId",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "goals",
                ":goalId"
              ],
              "variable": [
                {
                  "key": "goalId",
                  "value": "replace-with-actual-goal-id",
                  "description": "UUID of the goal to edit"
                }
              ]
            },
            "description": "Edit an existing goal. All fields are optional - only provided fields will be updated. When linkedInstitutions is updated, the system automatically adjusts institution allocations and recalculates completion status. Replace goalId with actual UUID from Get Goals response."
          },
          "response": []
        },
        {
          "name": "Delete Goal",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{idToken}}",
                "description": "JWT token from login"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/goals/:goalId",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "goals",
                ":goalId"
              ],
              "variable": [
                {
                  "key": "goalId",
                  "value": "replace-with-actual-goal-id",
                  "description": "UUID of the goal to delete"
                }
              ]
            },
            "description": "Delete a goal and automatically update all linked institutions. The system reduces each institution's allocatedPercent by the amount allocated to this goal and removes the goal from their linkedGoals lists. Replace goalId with actual UUID from Get Goals response."
          },
          "response": []
        }
      ]
    },
    {
      "name": "Public Endpoints",
      "item": [
        {
          "name": "Hello",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/hello",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "hello"
              ]
            },
            "description": "Test endpoint to verify API is running"
          },
          "response": []
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:8080",
      "type": "string"
    }
  ]
}

services:
  cpsc-backend-api:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: cpsc-backend-api
    ports:
      - "9090:8080"
    environment:
      # AWS Configuration - use your actual values or AWS credentials
      AWS_REGION: ${AWS_REGION:-us-east-1}
      AWS_SECRET_NAME: ${AWS_SECRET_NAME:-cpsc-backend/cognito}
      # Spring Boot Configuration
      SPRING_PROFILES_ACTIVE: ${SPRING_PROFILES_ACTIVE:-default}
      # JVM Options
      JAVA_OPTS: "-Xmx512m -Xms256m"
    volumes:
      # Mount AWS credentials file from host
      - ${USERPROFILE}\.aws:/home/appuser/.aws:ro
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8080/api/hello"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 40s
    networks:
      - cpsc-network
    restart: unless-stopped

networks:
  cpsc-network:
    driver: bridge
